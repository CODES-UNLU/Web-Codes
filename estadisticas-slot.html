<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游늵 Estad칤sticas del Slot Machine - CODES</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <style>
        .stats-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .stats-card {
            background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #555;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #39c0c3, #2a8a8d);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(57, 192, 195, 0.3);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .combination-item {
            background: linear-gradient(145deg, #333, #222);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid #39c0c3;
        }
        
        .loading {
            text-align: center;
            color: #39c0c3;
            font-size: 1.2rem;
        }
        
        .error {
            color: #ff6b35;
            text-align: center;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="stats-container">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="text-center mb-4">
                        <h1 class="text-white">
                            <i class="fas fa-chart-line"></i> Estad칤sticas del Slot Machine
                        </h1>
                        <p class="text-muted">Centro de Estudiantes CODES</p>
                        <button class="btn btn-outline-info btn-sm" onclick="testDebug()">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="row" id="statsContent">
                <div class="col-12">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Cargando estad칤sticas...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                console.log('Cargando estad칤sticas...');
                const response = await fetch('api/stats.php');
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Datos recibidos:', data);
                
                if (data.success) {
                    displayStats(data.stats);
                } else {
                    showError(data.message);
                }
            } catch (error) {
                console.error('Error cargando estad칤sticas:', error);
                showError('Error al cargar las estad칤sticas: ' + error.message);
            }
        }
        
        function displayStats(stats) {
            const content = document.getElementById('statsContent');
            console.log('Mostrando estad칤sticas:', stats);
            
            content.innerHTML = `
                <div class="col-md-6 col-lg-3">
                    <div class="stat-item">
                        <div class="stat-value">${stats.totalGames}</div>
                        <div class="stat-label">Total de Juegos</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-item">
                        <div class="stat-value">${stats.wins}</div>
                        <div class="stat-label">Ganados</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-item">
                        <div class="stat-value">${stats.losses}</div>
                        <div class="stat-label">Perdidos</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-item">
                        <div class="stat-value">${stats.winRate}</div>
                        <div class="stat-label">Tasa de Ganancia</div>
                    </div>
                </div>
                
                <div class="col-12">
                    <div class="stats-card">
                        <h3 class="text-white mb-4">
                            <i class="fas fa-trophy"></i> Resumen Financiero
                        </h3>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <div class="stat-value">$${stats.totalWinnings}</div>
                                    <div class="stat-label">Total Ganado</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <div class="stat-value">$${stats.averageWin}</div>
                                    <div class="stat-label">Ganancia Promedio</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-item">
                                    <div class="stat-value">$${stats.biggestWin}</div>
                                    <div class="stat-label">Mayor Ganancia</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-12">
                    <div class="stats-card">
                        <h3 class="text-white mb-4">
                            <i class="fas fa-info-circle"></i> Informaci칩n del Sistema
                        </h3>
                        <div class="text-center">
                            <p class="text-muted">
                                <i class="fas fa-database"></i> Datos almacenados localmente en JSON
                            </p>
                            <p class="text-muted">
                                <i class="fas fa-sync"></i> Actualizaci칩n autom치tica cada 30 segundos
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showError(message) {
            const content = document.getElementById('statsContent');
            content.innerHTML = `
                <div class="col-12">
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i> ${message}
                    </div>
                </div>
            `;
        }
        
        async function testDebug() {
            try {
                console.log('Probando endpoint de estad칤sticas...');
                const response = await fetch('api/stats.php');
                const data = await response.json();
                console.log('Stats data:', data);
                if (data.success) {
                    displayStats(data.stats);
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error en debug:', error);
                alert('Error en debug: ' + error.message);
            }
        }
        
        // Cargar estad칤sticas al cargar la p치gina
        document.addEventListener('DOMContentLoaded', loadStats);
        
        // Actualizar cada 30 segundos
        setInterval(loadStats, 30000);
    </script>
</body>
</html>
