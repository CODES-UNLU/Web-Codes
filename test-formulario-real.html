<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Formulario Real - Sorteo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:disabled { background: #ccc; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; max-height: 400px; overflow-y: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Formulario Real del Sorteo</h1>
        
        <div class="status info">
            <h3>üìã Simulaci√≥n del formulario real:</h3>
            <p>Esta p√°gina simula exactamente el formulario de sorteo.html para debuggear el problema.</p>
        </div>

        <form id="sorteoForm">
            <div class="form-group">
                <label for="nombre">Nombre *</label>
                <input type="text" id="nombre" name="nombre" value="Juan" required>
            </div>
            
            <div class="form-group">
                <label for="apellido">Apellido *</label>
                <input type="text" id="apellido" name="apellido" value="P√©rez" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" value="juan@ejemplo.com" required>
            </div>
            
            <div class="form-group">
                <label for="dni">DNI *</label>
                <input type="text" id="dni" name="dni" value="12345678" maxlength="8" required>
            </div>
            
            <div class="form-group">
                <label for="telefono">Tel√©fono *</label>
                <input type="tel" id="telefono" name="telefono" value="11-1234-5678" required>
            </div>
            
            <div class="form-group">
                <label for="cantidadChances">Cantidad de Chances *</label>
                <select id="cantidadChances" name="cantidadChances" required>
                    <option value="">Seleccionar</option>
                    <option value="1">1 chance - $1.000</option>
                    <option value="3" selected>3 chances - $2.800</option>
                    <option value="4">4 chances - $4.000</option>
                </select>
            </div>
            
            <button type="submit" class="btn-submit">Registrar Participaci√≥n</button>
        </form>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxOxMXytFzphjVGZ13jIFZxZ8HNCWABjjLTQC2Lpiiac2Vw9nwqlNsn82hK5_yCUQxbjw/exec';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            logDiv.innerHTML += `<div>[${timestamp}] ${emoji} ${message}</div>`;
            console.log(message);
        }
        
        async function enviarAGoogleSheets(formData) {
            try {
                log('Enviando datos a Google Sheets...');
                log('URL: ' + GOOGLE_SHEETS_URL);
                log('Datos: ' + JSON.stringify(formData, null, 2));
                
                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                log('Respuesta del servidor: ' + response.status + ' ' + response.statusText);
                log('Tipo de respuesta: ' + response.type);
                
                return { success: true };
            } catch (error) {
                log('Error: ' + error.message, 'error');
                return { success: false, error: error.message };
            }
        }
        
        // Simular el pago confirmado
        const pagado = 'ok';
        
        document.getElementById('sorteoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            log('üéØ Formulario enviado - Iniciando proceso');

            // Validar que el pago fue confirmado
            if (pagado !== 'ok') {
                log('Pago no confirmado, pagado = ' + pagado, 'error');
                alert('Debes completar el pago antes de enviar el formulario.');
                return;
            }
            log('Pago confirmado, procediendo con env√≠o');

            // Obtener datos del formulario
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const email = document.getElementById('email').value;
            const dni = document.getElementById('dni').value;
            const telefono = document.getElementById('telefono').value;
            const cantidadChances = document.getElementById('cantidadChances').value;
            
            log('üìã Campos del formulario:');
            log('  - Nombre: ' + nombre);
            log('  - Apellido: ' + apellido);
            log('  - Email: ' + email);
            log('  - DNI: ' + dni);
            log('  - Tel√©fono: ' + telefono);
            log('  - Cantidad de Chances: ' + cantidadChances);
            
            const formData = {
                nombre: nombre,
                apellido: apellido,
                email: email,
                dni: dni,
                telefono: telefono,
                cantidadChances: cantidadChances,
                pagoConfirmado: true,
                fechaRegistro: new Date().toISOString(),
                timestamp: new Date().getTime()
            };
            
            log('üìä Datos completos del formulario: ' + JSON.stringify(formData, null, 2));

            // Validar campos requeridos
            if (!formData.nombre || !formData.apellido || !formData.email || 
                !formData.dni || !formData.telefono || !formData.cantidadChances) {
                log('‚ùå Campos requeridos incompletos', 'error');
                alert('Por favor completa todos los campos requeridos.');
                return;
            }

            const submitBtn = document.querySelector('.btn-submit');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = 'Enviando...';
            submitBtn.disabled = true;

            try {
                log('Iniciando env√≠o a Google Sheets...');
                const result = await enviarAGoogleSheets(formData);
                
                if (result.success) {
                    log('‚úÖ Env√≠o exitoso a Google Sheets', 'success');
                    alert('¬°Participaci√≥n registrada exitosamente! Gracias por participar.');
                    this.reset();
                } else {
                    log('‚ùå Error en el env√≠o: ' + result.error, 'error');
                    throw new Error(result.error || 'Error desconocido');
                }
            } catch (error) {
                log('‚ùå Error inesperado: ' + error.message, 'error');
                alert('Hubo un error al enviar el formulario. Por favor intenta nuevamente.');
            }
            
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
        
        log('P√°gina de test del formulario real cargada. Listo para probar.');
    </script>
</body>
</html> 